<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Painel de Produção</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  padding: 15px;
}
.item {
  border-bottom: 1px solid #ddd;
  padding: 8px 0;
}
select {
  padding: 5px;
}
button {
  padding: 8px 12px;
  margin-top: 10px;
}
</style>
</head>
<body>

<h2>Painel de Produção</h2>

<input type="file" id="file">
<br>
<button onclick="upload()">Enviar XLS</button>

<hr>

<div id="lista"></div>

<script>
async function carregar() {
  const res = await fetch('/dados');
  const data = await res.json();

  const lista = document.getElementById('lista');
  lista.innerHTML = '';

  data.forEach((i, idx) => {
    lista.innerHTML += `
      <div class="item">
        <strong>${i.item}</strong><br>
        Máquina: ${i.maquina}<br>
        Vendido: ${i.vendido} | Produzir: ${i.produzir}<br>
        Status:
        <select onchange="alterar(${idx}, this.value)">
          <option value="producao" ${i.status==='producao'?'selected':''}>Produção</option>
          <option value="finalizado" ${i.status==='finalizado'?'selected':''}>Finalizado</option>
        </select>
      </div>
    `;
  });
}

async function upload() {
  const file = document.getElementById('file').files[0];
  if (!file) {
    alert('Selecione um arquivo XLS');
    return;
  }

  const form = new FormData();
  form.append('file', file);

  await fetch('/upload', {
    method: 'POST',
    body: form
  });

  carregar();
}

async function alterar(idx, status) {
  const res = await fetch('/dados');
  const data = await res.json();
  data[idx].status = status;

  await fetch('/salvar', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(data)
  });
}

carregar();
</script>

</body>
</html>
